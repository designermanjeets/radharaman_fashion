import{Ac as R,Bc as U,Cc as T,Ea as E,r as n,s as f,u as c,wc as I,xc as L,yc as x,zc as P}from"./chunk-7O7SQALI.js";import{a as $}from"./chunk-AEUEW5I5.js";import{a as j}from"./chunk-AYDT5PCT.js";import{n as b}from"./chunk-5X53ELV2.js";import{Cd as k,J as g,a as m,b as u,fa as i,i as _,la as h,p as a,qa as l,r as v}from"./chunk-GBAWEVO3.js";var d=class y{constructor(t,e,r){this.notificationService=t,this.router=e,this.orderService=r}static order(t){return t.order}static selectedOrder(t){return t.selectedOrder}static checkout(t){return t.checkout}getOrders(t,e){return this.orderService.getOrders(e?.payload).pipe(i({next:r=>{t.patchState({order:{data:r.data,total:r?.total?r?.total:r.data?.length}})},error:r=>{throw new Error(r?.error?.message)}}))}viewOrder(t,{id:e}){this.orderService.skeletonLoader=!0;let r=new _(o=>{setTimeout(()=>{o.error(new Error("View order request timed out"))},15e3)});return this.orderService.viewOrder(e).pipe(i({next:o=>{let s=t.getState();t.patchState(u(m({},s),{selectedOrder:o}))},error:o=>{console.error("View order error:",o);let s=t.getState();throw t.patchState(u(m({},s),{selectedOrder:null})),new Error(o?.error?.message||"Failed to load order details")},complete:()=>{this.orderService.skeletonLoader=!1}}),g(o=>(this.orderService.skeletonLoader=!1,console.error("View order failed:",o),v(null))))}checkout(t,e){return this.orderService.checkout(e?.payload).pipe(i({next:r=>{let o=t.getState();t.patchState(u(m({},o),{checkout:r}))},error:r=>{throw new Error(r?.error?.message)}}))}placeOrder(t,e){return this.orderService.placeOrder(e?.payload).pipe(i({next:r=>{(e.payload.payment_method=="cod"||e.payload.payment_method=="radha_cashfree"||e.payload.payment_method=="starpaisa_radha"||e.payload.payment_method=="bank_transfer")&&!r.is_guest?this.router.navigateByUrl(`/account/order/details/${r.order_number}`):(e.payload.payment_method=="cod"||e.payload.payment_method=="radha_cashfree"||e.payload.payment_method=="starpaisa_radha"||e.payload.payment_method=="bank_transfer")&&r.is_guest?this.router.navigate(["order/details"],{queryParams:{order_number:r.order_number,email_or_phone:e?.payload.email}}):window.open(r.url,"_self")},error:r=>{throw new Error(r?.error?.message)}}))}rePayment(t,e){return this.orderService.rePayment(e.payload).pipe(i({next:r=>{(e.payload.payment_method=="cod"||e.payload.payment_method=="radha_cashfree"||e.payload.payment_method=="starpaisa_radha"||e.payload.payment_method=="bank_transfer")&&!r.is_guest?this.router.navigateByUrl(`/account/order/details/${r.order_number}`):(e.payload.payment_method=="cod"||e.payload.payment_method=="radha_cashfree"||e.payload.payment_method=="starpaisa_radha"||e.payload.payment_method=="bank_transfer")&&r.is_guest?this.router.navigate(["order/details"],{queryParams:{order_number:r.order_number,email_or_phone:r.email}}):window.open(r.url,"_self")},error:r=>{throw new Error(r?.error?.message)}}))}orderTracking(t,e){this.notificationService.notification=!1,this.orderService.skeletonLoader=!0;let r=new _(o=>{setTimeout(()=>{o.error(new Error("Order tracking request timed out"))},15e3)});return this.orderService.orderTracking(e.payload).pipe(i({next:o=>{let s=t.getState();t.patchState(u(m({},s),{selectedOrder:o}))},error:o=>{console.error("Order tracking error:",o);let s=t.getState();throw t.patchState(u(m({},s),{selectedOrder:null})),new Error(o?.error?.message||"Failed to load order details")},complete:()=>{this.orderService.skeletonLoader=!1}}),g(o=>(this.orderService.skeletonLoader=!1,console.error("Order tracking failed:",o),v(null))))}downloadInvoice(t,e){return this.orderService.downloadInvoice(e.payload).pipe(i({next:r=>{let o=new Blob([r],{type:"pdf"}),s=window.URL.createObjectURL(o),w=document.createElement("a");w.href=s,w.download=`invoice-${e.payload.order_number}.pdf`,w.click(),window.URL.revokeObjectURL(s)},error:r=>{throw new Error(r?.error?.message)}}))}static{this.\u0275fac=function(e){return new(e||y)(l(E),l(b),l($))}}static{this.\u0275prov=h({token:y,factory:y.\u0275fac})}};a([n(I)],d.prototype,"getOrders",null);a([n(L)],d.prototype,"viewOrder",null);a([n(x)],d.prototype,"checkout",null);a([n(P)],d.prototype,"placeOrder",null);a([n(R)],d.prototype,"rePayment",null);a([n(U)],d.prototype,"orderTracking",null);a([n(T)],d.prototype,"downloadInvoice",null);a([c()],d,"order",null);a([c()],d,"selectedOrder",null);a([c()],d,"checkout",null);d=a([f({name:"order",defaults:{order:{data:[],total:0},selectedOrder:null,checkout:null}})],d);var G=(()=>{class p{static{this.type="[Order Status] Get"}constructor(e){this.payload=e}}return p})();var q=(()=>{class p{constructor(e){this.http=e}getOrderStatus(e){return this.http.get(`${j.URL}/orderStatus`,{params:e})}static{this.\u0275fac=function(r){return new(r||p)(l(k))}}static{this.\u0275prov=h({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();var S=class O{constructor(t){this.orderStatusService=t}static orderStatus(t){return t.orderStatus}static orderStatuses(t){return t.orderStatus.data.map(e=>({label:e?.name,value:e?.id}))}static selectedOrderStatus(t){return t.selectedOrderStatus}getOrderStatus(t,e){return this.orderStatusService.getOrderStatus(e.payload).pipe(i({next:r=>{t.patchState({orderStatus:{data:r.data,total:r?.total?r?.total:r.data?.length}})},error:r=>{throw new Error(r?.error?.message)}}))}static{this.\u0275fac=function(e){return new(e||O)(l(q))}}static{this.\u0275prov=h({token:O,factory:O.\u0275fac})}};a([n(G)],S.prototype,"getOrderStatus",null);a([c()],S,"orderStatus",null);a([c()],S,"orderStatuses",null);a([c()],S,"selectedOrderStatus",null);S=a([f({name:"orderStatus",defaults:{orderStatus:{data:[],total:0},selectedOrderStatus:null}})],S);export{d as a,G as b,S as c};
